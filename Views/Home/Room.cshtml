@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Home page";
}

<div class="container-fluid h-100 mt-5">
    <div class="row justify-content-center h-100">
        <div class="col-md-10 col-xl-9 col-sm-12 chat">
            <a class="btn btn-danger w-100" asp-area="" asp-controller="Home" asp-action="Logout">Leave Room</a><br /><br />
            <div class="card pt-4">
                <div class="card-body msg_card_body" id="chatBox">
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            Hi, how are you samim?
                            <span class="msg_time"><b>Oussidi1998</b> &nbsp;&nbsp;8:40 AM, Today</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end mb-4">
                        <div class="msg_cotainer_send">
                            Hi Khalid i am good tnx how about you?
                            <span class="msg_time"><b>Me</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            I am good too, thank you for your chat template
                            <span class="msg_time"><b>Oussidi1998</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-end mb-4">
                        <div class="msg_cotainer_send">
                            You are welcome
                            <span class="msg_time"><b>Me</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            I am looking for your next templates
                            <span class="msg_time"><b>Oussidi1998</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-end mb-4">
                        <div class="msg_cotainer_send">
                            Ok, thank you have a good day
                            <span class="msg_time"><b>Me</b>&nbsp;&nbsp;8:40 AM, Today</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            I am looking for your next templates
                            <span class="msg_time"><b>Oussidi1998</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-end mb-4">
                        <div class="msg_cotainer_send">
                            Ok, thank you have a good day
                            <span class="msg_time"><b>Me</b>&nbsp;&nbsp;8:40 AM, Today</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            I am looking for your next templates
                            <span class="msg_time"><b>Oussidi1998</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-end mb-4">
                        <div class="msg_cotainer_send">
                            Ok, thank you have a good day
                            <span class="msg_time"><b>Me</b>&nbsp;&nbsp;8:40 AM, Today</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            I am looking for your next templates
                            <span class="msg_time"><b>Oussidi1998</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-end mb-4">
                        <div class="msg_cotainer_send">
                            Ok, thank you have a good day
                            <span class="msg_time"><b>Me</b>&nbsp;&nbsp;8:40 AM, Today</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            I am looking for your next templates
                            <span class="msg_time"><b>Oussidi1998</b> &nbsp;&nbsp;8:40 AM, Today</span>

                        </div>
                    </div>
                    <div class="d-flex justify-content-end mb-4">
                        <div class="msg_cotainer_send">
                            Ok, thank you have a good day
                            <span class="msg_time"><b>Me</b>&nbsp;&nbsp;8:40 AM, Today</span>
                        </div>
                    </div>
                    <div class="d-flex justify-content-start mb-4">
                        <div class="msg_cotainer">
                            Bye, see you
                            <span class="msg_time"><b>Oussidi1998</b>&nbsp;&nbsp;8:40 AM, Today</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class="input-group">
                        <input name="" class="form-control type_msg" id="message" placeholder="Type your message..." />
                        <div class="input-group-append">
                            <button style="border:none">
                                <span class="input-group-text send_btn" id="sendButton"><i class="fas fa-location-arrow"></i></span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>

    $(function () {

        // need function to load sockets

        $("#sendButton").on("click", function () {

            var message = $("#message").val();
            var time = new Date();
            var isValid = true;
            if (!message) {
                isValid = false;
            }

            if (isValid) {

                $.post("/home/SendMessage", { message }, function (data) {
                    if (!data.success) {
                        var errorContainer = document.createElement("div");
                        errorContainer.className = " alert alert-danger";
                        errorContainer.innerHTML = "&#9888;Error sending the message"
                         document.getElementById("chatBox").appendChild(errorContainer);
                        

                    } else {
                        var container = document.createElement("div");
                        container.className = "d-flex justify-content-end mb-4";
                        //The message
                        var messageContainer = document.createElement("div");
                        messageContainer.className = "msg_cotainer_send";
                        messageContainer.innerHTML = message;
                        container.appendChild(messageContainer);
                        document.getElementById("chatBox").appendChild(container);
                        //The sender of the msg

                        var senderContainer = document.createElement("span");
                        senderContainer.className="msg_time";

                        var sender = document.createElement("b");
                        sender.innerHTML = "Me";

                        senderContainer.appendChild(sender);
                        senderContainer.innerHTML = "&nbsp;&nbsp;" + time.toLocaleString(); 
                        messageContainer.appendChild(senderContainer);
                        $("#message").val('');
                    }
                })
            }

            return false;
        })
    })
 
</script>